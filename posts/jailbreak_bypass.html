
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    
        <title>Jailbreak bypass</title>
        <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    
    
        
    
    
    <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
    
    
        <link href="../css/styles.css" rel="stylesheet" />
        <link href="../css/prism.css" rel="stylesheet" />
    
</head>

    <body>
        
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="../index.html">Home</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../about.html">About</a></li>
                        
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../pages/exploits.html">Vulnerabilities</a></li>
                        
                    </ul>
                </div>
            </div>
        </nav>
        
        <header class="masthead" style="background-image: url('../assets/img/post-bg.jpg');">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Jailbreak bypass</h1>
                            <h2 class="subheading">Simple jailbreak detection bypass</h2>
                            <span class="meta">
                                Posted by
                                <a href="#!">lateralusd</a>
                                on 2021-01-25 18:05:36
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7 ct">
                        <h2 id="introduction">Introduction</h2>

<p>There are thousands of posts just like this one which describes how you should approach bypassing jailbreak detection. This one isn&rsquo;t different, just more step-by-step guide. We will be using <em>frida</em> and <em>class-dump</em> to bypass jailbreak detection. At the end of the post, there will be short snippet how to use theos instead of frida. You should have dumped .ipa file of the application and also you need to unzip .ipa file.</p>

<h2 id="information-gathering">Information Gathering</h2>

<p>After running the application, we are being presented with a sheet view that shows us a message that we can&rsquo;t use the application on jailbroken device. In order to bypass this, we first need to check whether there are some methods which are doing this check.</p>

<p>After opening the app we are greeted with a view like the one below which translates to &ldquo;<em>It is not possible to use CLIENT NAME application on the devices that allows escalation of privileges to system level. For more details, please contant support.</em>&rdquo;</p>

<p><img src="../images/jailbroken_running.png" alt="View on jailbroken device" /></p>

<p>First, let&rsquo;s dump the classes to see if we will find anything interesting using <em>class-dump</em> tool.</p>

<p><strong>NOTE:</strong>
<em>Substitute word Example.app with the app you have</em>.</p>

<pre><code>$ ~/Downloads/class-dump -S -s -H Payload/Example.app/Example -o /tmp/example_headers
</code></pre>

<p>Let&rsquo;s examine these headers.</p>

<pre><code>$ cd /tmp/example_headers
$ ls -l | grep -iP root|jailbreak
[ ... REDACTED ... ]
-rw-r--r--  1 daemon1  wheel    545 Jan 26 09:26 RootCheckResult.h
-rw-r--r--  1 daemon1  wheel    910 Jan 26 09:26 RootManagerModule.h
</code></pre>

<p>We have found two interesting header files in there, <em>RootCheckResult.h</em> and <em>RootManagerModule.h</em>. Lets examine both and see what we will found in there.</p>

<pre><code>$ cat RootCheckResult.h
//
//     Generated by class-dump 3.5 (64 bit) (Debug version compiled Sep 17 2017 16:24:48).
//
//     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2015 by Steve Nygard.
//

#import &lt;objc/NSObject.h&gt;

@class NSString;

@interface RootCheckResult : NSObject
{
    _Bool _isRooted;
    NSString *_rootCheckFailed;
}

- (void).cxx_destruct;
- (id)init;
@property(nonatomic) _Bool isRooted; // @synthesize isRooted=_isRooted;
@property(retain, nonatomic) NSString *rootCheckFailed; // @synthesize rootCheckFailed=_rootCheckFailed;

@end
</code></pre>

<p>And <em>RootManagerModule.h</em>:</p>

<pre><code>$ cat RootManagerModule.h
//
//     Generated by class-dump 3.5 (64 bit) (Debug version compiled Sep 17 2017 16:24:48).
//
//     class-dump is Copyright (C) 1997-1998, 2000-2001, 2004-2015 by Steve Nygard.
//

#import &lt;objc/NSObject.h&gt;

#import &quot;RCTBridgeModule-Protocol.h&quot;

@class NSString, RCTBridge;
@protocol OS_dispatch_queue;

@interface RootManagerModule : NSObject &lt;RCTBridgeModule&gt;
{
}

+ (void)load;
+ (id)moduleName;
- (_Bool)canViolateSandbox;
- (_Bool)checkPaths;
- (_Bool)checkSchemes;
- (id)constantsToExport;
- (id)isJailBroken;
- (id)pathsToCheck;
- (id)schemesToCheck;

// Remaining properties
@property(readonly, nonatomic) __weak RCTBridge *bridge;
@property(readonly, copy) NSString *debugDescription;
@property(readonly, copy) NSString *description;
@property(readonly) unsigned long long hash;
@property(readonly, nonatomic) NSObject&lt;OS_dispatch_queue&gt; *methodQueue;
@property(readonly) Class superclass;

@end

</code></pre>

<p>We can see that we have property called <em>isRooted</em> inside RootCheckResult.h header file.</p>

<p>Let&rsquo;s write a short frida script to see when this property get&rsquo;s called. I will be using my own <a href="https://github.com/lateralusd/Helper-Scripts/blob/main/skeleton.sh">skeleton.sh</a> script to generate script for frida.</p>

<pre><code>$ ./skeleton.sh '-[RootCheckResult isRooted]' script.js
</code></pre>

<p>Let&rsquo;s see the content of it.</p>

<pre><code>$ cat script.js
var impl = ObjC.classes.RootCheckResult[&quot;- isRooted&quot;];

Interceptor.attach(impl.implementation, {
	onEnter: function(args) {
		console.log(&quot;Got called&quot;);
	},
	onLeave: function(retval) {
		console.log(&quot;Leaving function, retval is =&gt; &quot; + retval);
	}
});
</code></pre>

<p>Let&rsquo;s now run our application with frida using early instrumentation.</p>

<pre><code>$ frida -U -f com.echo.example -l script.js --no-pause
     ____
    / _  |   Frida 14.0.8 - A world-class dynamic instrumentation toolkit
   | (_| |
    &gt; _  |   Commands:
   /_/ |_|       help      -&gt; Displays the help system
   . . . .       object?   -&gt; Display information about 'object'
   . . . .       exit/quit -&gt; Exit
   . . . .
   . . . .   More info at https://www.frida.re/docs/home/
Spawned `com.echo.example`. Resuming main thread!
[iPhone::com.echo.example]-&gt; Got called
Leaving function, retval is =&gt; 0x1

</code></pre>

<h2 id="bypassing">Bypassing</h2>

<p>So we can see that our method get&rsquo;s called and that is returning 0x1 as an indication that the device is jailbroken. If we overwrite the return value, we may be able to bypass the check. Our updated <em>script.js</em> file looks like this:</p>

<pre><code>$ cat script.js
var impl = ObjC.classes.RootCheckResult[&quot;- isRooted&quot;];

Interceptor.attach(impl.implementation, {
	onEnter: function(args) {
		console.log(&quot;Got called&quot;);
	},
	onLeave: function(retval) {
		var newRetval = ptr(&quot;0x0&quot;); // Create a new variable with value 0x0
		retval.replace(newRetval);  // Replace old return value with the new one we have created
		console.log(&quot;Leaving function, retval is =&gt; &quot; + retval);
	}
});
</code></pre>

<p>Let&rsquo;s now run it and hope for the best.</p>

<pre><code>$ frida -U -f com.echo.example -l script.js --no-pause 
     ____
    / _  |   Frida 14.0.8 - A world-class dynamic instrumentation toolkit
   | (_| |
    &gt; _  |   Commands:
   /_/ |_|       help      -&gt; Displays the help system
   . . . .       object?   -&gt; Display information about 'object'
   . . . .       exit/quit -&gt; Exit
   . . . .
   . . . .   More info at https://www.frida.re/docs/home/
Spawned `com.echo.example`. Resuming main thread!
[iPhone::com.echo.example]-&gt; Got called
Leaving function, retval is =&gt; 0x0
</code></pre>

<p>We can see that we have indeed overwritten the return value and if we take a look on the application, we can see that we have bypassed it.</p>

<p><img src="../images/after_bypassing.png" alt="After bypassing" /></p>

<h2 id="theos-instead-of-frida">Theos instead of frida</h2>

<p>Fire up your <em>nic.pl</em>, select <em>iphone/tweak</em> and choose correct bundle for your application. In order to bypass this check using Theos, my Tweak.xmfile will look like this:</p>

<pre><code>$ cat Tweak.x

%hook RootCheckResult

-(_Bool) isRooted {
	return false;
}

%end
</code></pre>

                    </div>
                </div>
            </div>
            
    

        </article>
        
        
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.github.com/lateralusd">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="mailto:xdaemonx@protonmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://lateralusd.github.io//index.xml">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Copyright &copy; lateralusd 2023</div>
                        <div class="small text-center text-muted fst-italic">Made with <a href="https://github.com/lateralusd/bloggy">bloggy</a></div>
                    </div>
                </div>
            </div>
        </footer>
        <style>
            .ct > p img {
                height: 100%;
                width: 100%;
            }
        </style>

        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        
        <script src="../js/scripts.js"></script>
        <script src="../js/prism.js"></script>
    </body>
</html>
