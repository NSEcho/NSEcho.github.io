
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    
        <title>Fun RCE with PHP upload</title>
        <link rel="icon" type="image/x-icon" href="../assets/favicon.ico" />
    
    
        
            <link href="../css/custom.css" rel="stylesheet"/>
        
    
    
    <script src="https://use.fontawesome.com/releases/v5.15.4/js/all.js" crossorigin="anonymous"></script>
    
    <link href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" rel="stylesheet" type="text/css" />
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" rel="stylesheet" type="text/css" />
    
    
        <link href="../css/styles.css" rel="stylesheet" />
        <link href="../css/prism.css" rel="stylesheet" />
    
</head>

    <body>
        
        <nav class="navbar navbar-expand-lg navbar-light" id="mainNav">
            <div class="container px-4 px-lg-5">
                <a class="navbar-brand" href="../index.html">Home</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                    Menu
                    <i class="fas fa-bars"></i>
                </button>
                <div class="collapse navbar-collapse" id="navbarResponsive">
                    <ul class="navbar-nav ms-auto py-4 py-lg-0">
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../index.html">Home</a></li>
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../about.html">About</a></li>
                        
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../pages/cves.html">CVEs</a></li>
                        
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../pages/exploits.html">Vulnerabilities</a></li>
                        
                        <li class="nav-item"><a class="nav-link px-lg-3 py-3 py-lg-4" href="../tags.html">Tags</a></li>
                    </ul>
                </div>
            </div>
        </nav>
        
        <header class="masthead" style="background-image: url('../assets/img/post-bg.jpg');">
            <div class="container position-relative px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <div class="post-heading">
                            <h1>Fun RCE with PHP upload</h1>
                            <h2 class="subheading">500 Internal Error sometimes can be good</h2>
                            
                                <a href="../tags/web.html"><button type="button" class="btn btn-primary btn-sm">web</button></a>
                            
                                <a href="../tags/rce.html"><button type="button" class="btn btn-primary btn-sm">rce</button></a>
                            
                            <br><br>
                            <span class="meta">
                                Posted by
                                <a href="#!">NSEcho</a>
                                on 2020-08-17 13:09:06
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <article class="mb-4">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7 ct">
                        <h2 id="introduction">Introduction</h2>

<p>I know this is not about MacOS nor iOS but this was something that had to be written.</p>

<p>Recently I had a web application penetration test on which I have found CSV injection and a great example of bypassing PHP image upload. Users with admin privileges had an option to change user&rsquo;s profile picture which immediately caught my eye.</p>

<h2 id="app-details">App details</h2>

<ul>
<li>Fictional hostname: example.com</li>
<li>Language: PHP</li>
<li>Framework: Laravel</li>
</ul>

<h2 id="analysis">Analysis</h2>

<p>After messing around with trying to upload some php shell I was constantly getting 500 Internal Server Error which was kinda a clue to me that application is not allowing anything besides good ol&rsquo; images.</p>

<p>Application is storing images on the server by generating random id and combining it with file extension. It gets stored at <strong><a href="http://example.com/images/users/ID.EXTENSION">http://example.com/images/users/ID.EXTENSION</a></strong>.</p>

<p>Example: <strong><a href="http://example.com/images/users/1191723995f3a343b45e2d9.82154619.jpg">http://example.com/images/users/1191723995f3a343b45e2d9.82154619.jpg</a></strong></p>

<h2 id="attack">Attack</h2>

<p>I first have tried to upload php file and change its filename to name.gif.php and embeding some PHP code without success. File gets uploaded as php but without execution which can be seen on following image.</p>

<p><img src="../images/burp_rce.png" alt="Request with GIF87a;" /></p>

<p>After inspecting elements, I saw that file got saved as <strong>864064135f3a686e303ab8.04907479.php</strong>, after checking with browser the location I saw only GIF87a; on the page.</p>

<p><img src="../images/first_try.png" alt="Output of image" /></p>

<p>The thing which caught my attention was 500 Internal Server Error even though the file got uploaded.</p>

<p>The next thing i have tried is removing completely <em>GIF87a;</em>, changing mime type to <strong>application/x-httpd-php</strong> and filename just to <strong>.gif.php</strong>. Application stripped .gif and saved php file, inspecting the element and checking the URL I saw that PHP file really got executed. Once again I got 500 Internal Server Error but the file got uploaded so I didn&rsquo;t really care.</p>

<p><img src="../images/execution.png" alt="Sending payload" /></p>

<p><img src="../images/php_execution.png" alt="Execution" /></p>

<p>Changing the body to <code>&lt;?php system($_GET[&quot;cmd&quot;]); ?&gt;</code>, uploading the file, getting the URL I have proceeded to get file <strong>/etc/passwd/</strong> with success and it is game over.</p>

<p><img src="../images/passwd.png" alt="Output of /etc/passwd file" /></p>

<h2 id="point-of-the-post">Point of the post</h2>

<p>Do not get discouraged if you get internal server error, try to mess around and play with everything you see. You never know what the application is doing when you are blackboxing.</p>

                    </div>
                </div>
            </div>
            
    

            
        
        
        <footer class="border-top">
            <div class="container px-4 px-lg-5">
                <div class="row gx-4 gx-lg-5 justify-content-center">
                    <div class="col-md-10 col-lg-8 col-xl-7">
                        <ul class="list-inline text-center">
                            <li class="list-inline-item">
                                <a href="">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://www.github.com/lateralusd">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="mailto:xdaemonx@protonmail.com">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                            <li class="list-inline-item">
                                <a href="https://nsecho.github.io//index.xml">
                                    <span class="fa-stack fa-lg">
                                        <i class="fas fa-circle fa-stack-2x"></i>
                                        <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
                                    </span>
                                </a>
                            </li>
                        </ul>
                        <div class="small text-center text-muted fst-italic">Copyright &copy; NSEcho 2023</div>
                        <div class="small text-center text-muted fst-italic">Made with <a href="https://github.com/lateralusd/bloggy">bloggy</a></div>
                    </div>
                </div>
            </div>
        </footer>
        <style>
            .ct > p img {
                height: 100%;
                width: 100%;
            }
        </style>

        
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
        
        <script src="../js/scripts.js"></script>
        <script src="../js/prism.js"></script>
    </body>
</html>
